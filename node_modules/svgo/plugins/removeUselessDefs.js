'use strict';

exports.type = 'perItem';

exports.active = true;

exports.description = 'removes elements in <defs> without id';

<<<<<<< HEAD
var nonRendering = require('./_collections').elemsGroups.nonRendering,
    defs;
=======
var nonRendering = require('./_collections').elemsGroups.nonRendering;
>>>>>>> joan

/**
 * Removes content of defs and properties that aren't rendered directly without ids.
 *
 * @param {Object} item current iteration item
 * @return {Boolean} if false, item will be filtered out
 *
 * @author Lev Solntsev
 */
exports.fn = function(item) {

    if (item.isElem('defs')) {

<<<<<<< HEAD
        defs = item;
        item.content = (item.content || []).reduce(getUsefulItems, []);

=======
        if (item.content) {
            item.content = getUsefulItems(item, []);
        }
        
>>>>>>> joan
        if (item.isEmpty()) return false;

    } else if (item.isElem(nonRendering) && !item.hasAttr('id')) {

        return false;

    }

};

<<<<<<< HEAD
function getUsefulItems(usefulItems, item) {

    if (item.hasAttr('id') || item.isElem('style')) {

        usefulItems.push(item);
        item.parentNode = defs;

    } else if (!item.isEmpty()) {

        item.content.reduce(getUsefulItems, usefulItems);

    }
=======
function getUsefulItems(item, usefulItems) {

    item.content.forEach(function(child) {
        if (child.hasAttr('id') || child.isElem('style')) {

            usefulItems.push(child);
            child.parentNode = item;

        } else if (!child.isEmpty()) {

            child.content = getUsefulItems(child, usefulItems);

        }
    });
>>>>>>> joan

    return usefulItems;
}
